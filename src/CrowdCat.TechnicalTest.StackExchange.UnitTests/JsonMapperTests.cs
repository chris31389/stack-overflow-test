using System.Linq;
using NUnit.Framework;

namespace CrowdCat.TechnicalTest.StackExchange.UnitTests
{
    [TestFixture]
    public class JsonMapperTests
    {
        private const string jsonExample =
            "{\"items\":[{\"tags\":[\"c\",\"sockets\",\"udp\",\"fragmentation\"],\"view_count\":26},{\"tags\":[\"php\",\"wordpress\",\"woocommerce\"],\"view_count\":11},{\"tags\":[\"windows\",\"powershell\",\"cmd\"],\"view_count\":24},{\"tags\":[\"firefox\",\"firefox-addon\",\"firefox-webextensions\"],\"view_count\":9},{\"tags\":[\"php\",\"forms\"],\"view_count\":10},{\"tags\":[\"javascript\",\"html\",\"angularjs\"],\"view_count\":29},{\"tags\":[\"c#\",\"icloneable\"],\"view_count\":33},{\"tags\":[\"php\",\"database\",\"codeigniter\"],\"view_count\":19},{\"tags\":[\"c++\",\"unordered-map\"],\"view_count\":58},{\"tags\":[\"ruby-on-rails\"],\"view_count\":22},{\"tags\":[\"apache-spark\",\"rdd\"],\"view_count\":12},{\"tags\":[\"android\",\"ios\",\"firebase\",\"instagram\",\"instagram-api\"],\"view_count\":16},{\"tags\":[\"java\",\"jframe\",\"jpeg\"],\"view_count\":13},{\"tags\":[\"laravel\",\"vue.js\",\"vuex\",\"vue-router\"],\"view_count\":15},{\"tags\":[\"r\"],\"view_count\":35},{\"tags\":[\"matrix\",\"scheme\",\"racket\"],\"view_count\":19},{\"tags\":[\"linux\",\"x11\",\"xorg\"],\"view_count\":9},{\"tags\":[\"c#\",\"ilspy\"],\"view_count\":20},{\"tags\":[\"android\",\"android-fragments\",\"android-navigation\",\"android-navigationview\"],\"view_count\":11},{\"tags\":[\"flutter\",\"in-app-purchase\"],\"view_count\":17},{\"tags\":[\"javascript\",\"webhooks\",\"zapier\"],\"view_count\":16},{\"tags\":[\"android\",\"kotlin\"],\"view_count\":20},{\"tags\":[\"accessibility-insights\"],\"view_count\":30},{\"tags\":[\"python\",\"apache-spark\",\"pyspark\"],\"view_count\":19},{\"tags\":[\"bash\",\"timeout\"],\"view_count\":14},{\"tags\":[\"matlab\",\"mathematical-optimization\"],\"view_count\":8},{\"tags\":[\"go\"],\"view_count\":29},{\"tags\":[\"angular\",\"select\",\"binding\",\"angular-material\",\"angular8\"],\"view_count\":20},{\"tags\":[\"python\"],\"view_count\":34},{\"tags\":[\"python\"],\"view_count\":23},{\"tags\":[\"python\",\"python-3.x\"],\"view_count\":34},{\"tags\":[\"web-applications\",\"keycloak\"],\"view_count\":11},{\"tags\":[\"wix\"],\"view_count\":24},{\"tags\":[\"python\",\"pygame\"],\"view_count\":13},{\"tags\":[\"python-3.x\",\"madlib\"],\"view_count\":21},{\"tags\":[\"wordpress\",\"woocommerce\",\"product\",\"variations\"],\"view_count\":18},{\"tags\":[\"regex\",\"python-3.x\",\"string\",\"file-io\"],\"view_count\":22},{\"tags\":[\"javascript\",\"d3.js\"],\"view_count\":22},{\"tags\":[\"python\",\"runge-kutta\"],\"view_count\":27},{\"tags\":[\"c++\",\"crash\",\"hotkeys\"],\"view_count\":18},{\"tags\":[\"samesite\"],\"view_count\":12},{\"tags\":[\"swift\",\"crash\",\"appdelegate\"],\"view_count\":20},{\"tags\":[\"android\",\"node.js\",\"cordova\",\"ionic-framework\",\"npm\"],\"view_count\":16},{\"tags\":[\"sql-server\",\"columnstore\",\"sql-server-2019\"],\"view_count\":17},{\"tags\":[\"java\",\"swing\",\"graphics2d\",\"jtextpane\"],\"view_count\":30},{\"tags\":[\"android\",\"firebase\",\"firebase-realtime-database\"],\"view_count\":22},{\"tags\":[\"python\"],\"view_count\":45},{\"tags\":[\"webusb\"],\"view_count\":12},{\"tags\":[\"java\",\"android\"],\"view_count\":37},{\"tags\":[\"javascript\",\"typescript\",\"webpack\"],\"view_count\":42},{\"tags\":[\"symfony\",\"authentication\",\"comments\",\"article\"],\"view_count\":21},{\"tags\":[\"javascript\",\"arrays\",\"reactjs\",\"object\"],\"view_count\":39},{\"tags\":[\"python\"],\"view_count\":22},{\"tags\":[\"python\",\"dynamic\",\"xmlhttprequest\"],\"view_count\":15},{\"tags\":[\"wpf\",\"local-storage\",\"cefsharp\"],\"view_count\":20},{\"tags\":[\"html\",\"reactjs\",\"web\"],\"view_count\":21},{\"tags\":[\"django\",\"amazon-web-services\",\"amazon-elastic-beanstalk\"],\"view_count\":16},{\"tags\":[\"c#\",\"powershell\",\"cmd\",\"user32\",\"setparent\"],\"view_count\":42},{\"tags\":[\"android\",\"android-animation\",\"android-transitions\"],\"view_count\":14},{\"tags\":[\"python\",\"apache-spark\",\"pyspark\",\"yarn\"],\"view_count\":27},{\"tags\":[\"android\",\"xamarin\",\"xamarin.android\",\"android-9.0-pie\",\"sqlite.net\"],\"view_count\":23},{\"tags\":[\"php\",\"html\",\"mysql\",\"wordpress\",\"forms\"],\"view_count\":23},{\"tags\":[\"sql\",\"json\",\"sql-server\"],\"view_count\":34},{\"tags\":[\"java\",\"unit-testing\"],\"view_count\":11},{\"tags\":[\"scala\",\"shapeless\"],\"view_count\":21},{\"tags\":[\"sssd\"],\"view_count\":8},{\"tags\":[\"f#\"],\"view_count\":29},{\"tags\":[\"machine-learning\",\"cluster-analysis\",\"k-means\"],\"view_count\":7},{\"tags\":[\"java\",\"kotlin\",\"awt\",\"nio\"],\"view_count\":11},{\"tags\":[\"c++\",\"qt\"],\"view_count\":23},{\"tags\":[\"assembly\",\"syntax-error\",\"qtspim\",\"spim\"],\"view_count\":15},{\"tags\":[\"javascript\",\"animation\",\"rotation\",\"transform\",\"p5.js\"],\"view_count\":15},{\"tags\":[\"bootstrap-4\",\"form-control\"],\"view_count\":12},{\"tags\":[\"python-3.x\"],\"view_count\":8},{\"tags\":[\"python\",\"numpy\"],\"view_count\":11},{\"tags\":[\"matlab\",\"dataset\",\"fread\"],\"view_count\":32},{\"tags\":[\"api\",\"react-native\",\"authentication\"],\"view_count\":25},{\"tags\":[\"python-3.x\",\"formula\",\"statsmodels\"],\"view_count\":10},{\"tags\":[\"html\",\"node.js\",\"chat\"],\"view_count\":17},{\"tags\":[\"php\",\"wordpress\",\"forum\",\"buddypress\",\"bbpress\"],\"view_count\":7},{\"tags\":[\"python\",\"python-3.x\",\"jinja2\"],\"view_count\":14},{\"tags\":[\"recursion\",\"scheme\",\"racket\",\"swap\",\"r5rs\"],\"view_count\":28},{\"tags\":[\"java\",\"collections\"],\"view_count\":25},{\"tags\":[\"javascript\",\"node.js\",\"coordinates\",\"coordinate-systems\"],\"view_count\":21},{\"tags\":[\"apache-spark\"],\"view_count\":30},{\"tags\":[\"python\",\"pandas\",\"rounding\"],\"view_count\":24},{\"tags\":[\"php\",\"parsing\",\"syntax\"],\"view_count\":14},{\"tags\":[\"php\",\"jquery\",\"database\",\"laravel\",\"email\"],\"view_count\":39},{\"tags\":[\"ios\",\"objective-c\",\"swift\"],\"view_count\":59},{\"tags\":[\"gitahead\"],\"view_count\":11},{\"tags\":[\"javascript\",\"jquery\",\"jquery-ui\"],\"view_count\":18},{\"tags\":[\"haskell\",\"ghc\"],\"view_count\":29},{\"tags\":[\"machine-learning\",\"math\",\"model\",\"loss-function\"],\"view_count\":25},{\"tags\":[\"reactjs\",\"material-ui\",\"stepper\"],\"view_count\":24},{\"tags\":[\"sql-server\",\"sql-server-2000\"],\"view_count\":34},{\"tags\":[\"typescript\",\"jwt\",\"passport.js\",\"nestjs\"],\"view_count\":12},{\"tags\":[\"functional-programming\",\"scheme\",\"racket\"],\"view_count\":53},{\"tags\":[\"flutter\",\"dart\"],\"view_count\":28},{\"tags\":[\"excel\",\"excel-formula\"],\"view_count\":27},{\"tags\":[\"python-3.x\",\"tensorflow\",\"machine-learning\",\"neural-network\",\"mlp\"],\"view_count\":16}],\"has_more\":true}";
           
        private JsonMapper _jsonMapper;

        [SetUp]
        public void Setup()
        {
            _jsonMapper = new JsonMapper();
        }

        [Test]
        public void GivenValidJson_WhenIMap_ThenIGetQuestionsReturned()
        {
            // Act
            QuestionResponse questionResponse = _jsonMapper.Map(jsonExample);

            // Assert
            Assert.That(questionResponse, Is.Not.Null);
            Assert.That(questionResponse.Questions.Count(), Is.EqualTo(100));
            Assert.That(questionResponse.Questions.First().ViewTotal, Is.EqualTo(26));
            Assert.That(questionResponse.Questions.First().Tags, Contains.Item("c"));
            Assert.That(questionResponse.HasMore, Is.True);
        }
    }
}